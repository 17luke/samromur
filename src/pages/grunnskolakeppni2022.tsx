import * as React from 'react';
import { useEffect, useState } from 'react';
import styled from 'styled-components';
import Scoreboard from '../components/competition/bootstrap/school-scoreboard';
import Layout from '../components/layout/layout';
// import { ReddumTitle } from '../components/competition/ui/reddum-title';
import {
    fakeScores,
    getFakeScores,
    isCompetition,
    isCompetitionAndSuspenseOver,
    isCompetitionOver,
    isSuspense,
} from '../utilities/competition-helper';
import CompanyList from '../components/competition/company-list';
import Link from 'next/link';
// import * as colors from '../components/competition/ui/colors';
import { useRouter } from 'next/router';
// import PrimaryButton from '../components/competition/ui/comp-button-primary';
import { Button } from '../components/ui/buttons';
import useSWR from 'swr';
import { getCompetitionScores } from '../services/competition-api';
import { ScoreboardData } from '../types/competition';
import { CompetitionStats } from '../components/competition/competition-stats';
import { theme } from '../styles/global';
import { StyledLink } from '../components/ui/links/link';
import { pages } from '../constants/paths';
import AboutCompetition from '../components/competition/about';
import { AboutReddum } from '../components/competition/reddum-about';
import { CompetitionTypes, gk2022scoreboard } from '../constants/competition';

const CompetitionPageContainer = styled.div`
    max-width: ${({ theme }) => theme.layout.desktopWidth};
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    /* align-items: center; */
    padding: 1rem;
    margin: 0 auto;
    width: 100%;
    max-width: 50rem;
    /* min-width: 30rem; */
`;

const About = styled.div`
    max-width: ${({ theme }) => theme.layout.desktopWidth};
    margin: 1rem auto 2rem auto;
    /* text-align: center; */
`;

const BottomContent = styled.div`
    max-width: ${({ theme }) => theme.layout.desktopWidth};

    margin: 2rem 0;
    display: flex;
    flex-direction: column;
`;

const SelectorContainer = styled.div`
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
    width: 50rem;
    margin: 0 auto;
`;

const SelectableH2 = styled.h2`
    cursor: pointer;

    & :hover {
        color: ${({ theme }) => theme.colors.darkerBlue};
    }
`;

const TitleContainer = styled.div`
    margin: 1rem 0;
`;

const Title = styled.h2`
    margin-bottom: 1rem;
`;

const ScoreboardStatsContainer = styled.div`
    max-width: ${({ theme }) => theme.layout.desktopWidth};
    width: 100%;
    color: black; ;
`;

const CompanyListContainer = styled.div`
    display: flex;
    align-items: center;
`;

interface ButtonProps {
    color: string;
}

const CTAButton = styled.button<ButtonProps>`
    flex: 1;
    border: none;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-size: 1.3rem;
    padding: 0.5rem;
    background-color: ${({ color, theme }) => theme.colors[color]};
    color: white;
    cursor: pointer;
    width: 100%;
    max-width: 20rem;
    box-sizing: border-box;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    border: 1px solid white;
    transition: color, background-color 0.1s ease-in-out;

    & :active {
        transform: translateY(2px);
    }

    & :hover {
        background-color: white;
        color: ${({ color, theme }) => theme.colors[color]};
        border: 1px solid ${({ color, theme }) => theme.colors[color]};
    }
`;

interface SelectButtonProps {
    selected?: boolean;
}

const SelectButton = styled(Button)<SelectButtonProps>`
    padding: 0.5rem;
    border-radius: 0;
    color: ${({ theme }) => theme.colors.darkerBlue};
    background-color: white;
    font-family: ${({ theme }) => theme.fonts.title};
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color, background-color 0.1s ease-in-out;

    ${({ selected, theme }) =>
        selected
            ? `
        background-color: ${theme.colors.darkerBlue};
        color: white;
        `
            : ``}

    & :active {
        transform: none;
    }

    & :hover {
        ${({ theme }) =>
            `
                background-color: ${theme.colors.darkerBlue};
                color: white;
            `}
    }
    border: 1px solid ${({ theme }) => theme.colors.darkerBlue};
`;

const SelectorButtons = styled.div`
    display: flex;
    justify-content: flex-start;
    flex-direction: row;
    text-align: left;
    width: inherit;
    margin-left: 1px;
`;

const LogoContainer = styled.div`
    max-width: 20rem;

    transition: transform 0.2s; /* Animation */

    & :hover {
        transform: scale(1.1);
    }
`;

const Paragraph = styled.p`
    & span {
        font-weight: 600;
    }
`;

const Encourage = styled.p`
    font-weight: 600;
`;

const Announcement = styled.h3`
    margin-top: 2rem;
`;

enum CompanySizes {
    all = 'all',
    small = 'small',
    medium = 'medium',
    large = 'large',
}

const Competition: React.FunctionComponent = () => {
    const [showStats, setShowStats] = useState(false);
    const [selectedSize, setSelectedSize] = useState<CompanySizes | undefined>(
        CompanySizes.all
    );
    // const { data, error } = isSuspense()
    //     ? getFakeScores()
    //     : useSWR(CompetitionTypes.SCHOOL, getCompetitionScores);
    const data = isSuspense() ? fakeScores : gk2022scoreboard;
    const [filteredData, setFilteredData] = useState<
        ScoreboardData[] | undefined
    >(undefined);

    useEffect(() => {
        setFilteredData(data);
    }, [data]);

    const router = useRouter();

    const onSelectorClick = (size: CompanySizes) => {
        setSelectedSize(size);
        filterData(size);
        setShowStats(false);
    };

    const filterData = (size: CompanySizes) => {
        if (data == undefined) {
            return;
        }
        if (size == CompanySizes.all) {
            setFilteredData(data);
            return;
        }
        const filtered = data.filter((e) => e.size == size);
        const reRanked = filtered.map((e, index) => {
            const reRank: ScoreboardData = {
                ...e,
                rank: index + 1,
            };
            return reRank;
        });
        setFilteredData(reRanked);
    };

    const onShowStats = () => {
        setSelectedSize(undefined);
        setShowStats(true);
    };

    return (
        <Layout>
            <CompetitionPageContainer>
                <About>
                    {isCompetition() && !isSuspense() && <AboutDuring />}
                    {isSuspense() && <AboutSuspense />}
                    {isCompetitionAndSuspenseOver() && <AboutAfter />}
                    {!isCompetition() && !isCompetitionOver() && (
                        <AboutBefore />
                    )}
                </About>
                {(isCompetition() || isCompetitionOver()) && (
                    // {false && (
                    <>
                        <SelectorContainer>
                            <SelectableH2
                                onClick={() =>
                                    onSelectorClick(CompanySizes.all)
                                }
                            >
                                Stigatafla
                            </SelectableH2>
                            <h2>{' / '}</h2>
                            <SelectableH2 onClick={() => onShowStats()}>
                                LÃ­nurit
                            </SelectableH2>
                        </SelectorContainer>
                        {!isSuspense() && (
                            <SelectorButtons>
                                <SelectButton
                                    onClick={() =>
                                        onSelectorClick(CompanySizes.all)
                                    }
                                    selected={selectedSize == CompanySizes.all}
                                >
                                    Allir
                                </SelectButton>
                                <SelectButton
                                    onClick={() =>
                                        onSelectorClick(CompanySizes.large)
                                    }
                                    selected={
                                        selectedSize == CompanySizes.large
                                    }
                                >
                                    A
                                </SelectButton>
                                <SelectButton
                                    onClick={() =>
                                        onSelectorClick(CompanySizes.medium)
                                    }
                                    selected={
                                        selectedSize == CompanySizes.medium
                                    }
                                >
                                    B
                                </SelectButton>
                                <SelectButton
                                    onClick={() =>
                                        onSelectorClick(CompanySizes.small)
                                    }
                                    selected={
                                        selectedSize == CompanySizes.small
                                    }
                                >
                                    C
                                </SelectButton>
                            </SelectorButtons>
                        )}
                        <ScoreboardStatsContainer>
                            {!showStats && (
                                <Scoreboard
                                    blue
                                    data={filteredData}
                                    blurred={isSuspense()}
                                />
                            )}
                            {showStats && <CompetitionStats />}
                        </ScoreboardStatsContainer>
                    </>
                )}
                <BottomContent>
                    {(isCompetition() || isCompetitionOver()) && (
                        <AboutCompetitions />
                    )}
                    <Link href="/grunnskolakeppni" passHref>
                        <StyledLink>
                            Ertu aÃ° leita aÃ° GrunnskÃ³lakeppninni 2021?
                        </StyledLink>
                    </Link>
                    <br />
                    <Link href="/keppni" passHref>
                        <StyledLink>
                            Ertu aÃ° leita aÃ° Reddum mÃ¡linu 2021?
                        </StyledLink>
                    </Link>
                </BottomContent>
            </CompetitionPageContainer>
        </Layout>
    );
};

const AboutBefore: React.FunctionComponent = () => {
    return (
        <>
            <Title>HvaÃ°a skÃ³li les mest?</Title>
            <Paragraph>
                ÃriÃ°ja Lestrarkeppni grunnskÃ³lanna hefst Ã¾ann{' '}
                <span>20 janÃºar</span> nÃ¦stkomandi. Keppnin stendur yfir Ã­ viku
                og lÃ½kur <span>26 janÃºar.</span>
            </Paragraph>
            <p>
                Sem fyrr gengur keppnin Ãºt Ã¡ aÃ° lesa setningar hÃ©r inn Ã¡{' '}
                <Link href={'/'} passHref>
                    <StyledLink>samrÃ³mur.is</StyledLink>
                </Link>
                . UpptÃ¶kurnar munu svo mynda gagnasafn sem verÃ°ur notaÃ° til aÃ°
                Ã¾rÃ³a mÃ¡ltÃ¦knilausnir sem kenna tÃ¶lvum og tÃ¦kjum aÃ° skilja
                Ã­slensku. Forseti Ãslands og forsetafrÃº munu hefja keppnina og
                verÃ°launaafhending aÃ° henni lokinni fer fram Ã¡ BessastÃ¶Ã°um.
            </p>
            <p>
                Nemendur, foreldrar og starfsfÃ³lk skÃ³la geta lesiÃ° inn fyrir
                sinn skÃ³la. ViÃ° hvetjum alla til aÃ° taka Ã¾Ã¡tt Ã¾vÃ­ miklu skiptir
                aÃ° fÃ¡ framlÃ¶g frÃ¡ breiÃ°um hÃ³pi og tryggja Ã¾annig aÃ° tÃ¦knin
                skilji raddir og framburÃ° allra.
            </p>
            <p>
                SkÃ³lum er skipt Ã­ Ã¾rjÃ¡ flokka lÃ­kt og Ã­ fyrra og verÃ°laun veitt
                fyrir efsta sÃ¦tiÃ° Ã­ hverjum flokki. Ãar aÃ° auki verÃ°a veitt
                Ã¾renn verÃ°laun fyrir Ã¾Ã¡ skÃ³la sem skara fram Ãºr en eru ekki Ã­
                fyrsta sÃ¦ti Ã­ sÃ­num flokki.
            </p>
            <p>
                VerÃ°launin verÃ°a vegleg Ã­ Ã¡r og hlÃ¶kkum viÃ° til aÃ° segja meira
                frÃ¡ Ã¾eim Ã¡ nÃ¦stu dÃ¶gum.
            </p>
            <Paragraph>
                Ã fyrstu keppni 2020 Ã¾Ã¡ tÃ³ku <span>1.430</span> manns Ã¾Ã¡tt fyrir
                hÃ¶nd <span>130</span> skÃ³la og lÃ¡su Ã­ kringum <span>144</span>{' '}
                Ã¾Ãºsund setningar. Alls tÃ³ku um <span>6.000</span> manns Ã¾Ã¡tt
                fyrir hÃ¶nd <span>136</span> skÃ³la og lÃ¡su rÃºmlega{' '}
                <span>776</span> Ã¾Ãºsund setningar Ã­ annarri Lestrarkeppni
                grunnskÃ³la 2021. Yfir <span>920</span> Ã¾Ãºsund innlesnar
                setningar hafa Ã¾vÃ­ safnast undanfarin tvÃ¶ Ã¡r og erum viÃ° Ã¾vÃ­
                afar spennt fyrir Ã¾essari Ã¾riÃ°ju keppni og vonumst eftir
                Ã¾Ã¡tttÃ¶ku sem flestra skÃ³la.
            </Paragraph>
        </>
    );
};

const AboutDuring: React.FunctionComponent = () => {
    return (
        <>
            <Title>HvaÃ°a skÃ³li les mest?</Title>
            <p>ÃriÃ°ja Lestrarkeppni grunnskÃ³lanna 20 til 26. janÃºar.</p>
            <p>
                Nemendur, foreldrar og starfsfÃ³lk skÃ³la geta lesiÃ° inn fyrir
                sinn skÃ³la. ViÃ° hvetjum alla til aÃ° taka Ã¾Ã¡tt Ã¾vÃ­ miklu skiptir
                aÃ° fÃ¡ framlÃ¶g frÃ¡ breiÃ°um hÃ³pi og tryggja Ã¾annig aÃ° tÃ¦knin
                skilji raddir og framburÃ° allra.
            </p>
            <p>
                SkÃ³lum er skipt Ã­ Ã¾rjÃ¡ flokka lÃ­kt og Ã­ fyrra og verÃ°laun veitt
                fyrir efsta sÃ¦tiÃ° Ã­ hverjum flokki.
            </p>
            <Paragraph>
                Sigurvegari hvers flokks fÃ¦r vegleg verÃ°laun frÃ¡ Elko en hver
                sigurskÃ³li mun fÃ¡{' '}
                <span>Monoprice MP10 Mini Ã¾rÃ­vÃ­ddar prentara</span> og eitt sett
                af <span>Rasberry Pi 400 tÃ¶lvu</span>. Einnig verÃ°a veitt
                verÃ°laun til Ã¾riggja skÃ³la sem skara fram Ãºr, en vinna ekki sinn
                flokk, en hver Ã¾eirra mun fÃ¡ tvÃ¶ sett af{' '}
                <span>Rasberry Pi 400 tÃ¶lvum</span>.
            </Paragraph>

            {isSuspense() && (
                <>
                    <p>
                        Lestrarkeppni grunskÃ³lanna lÃ½kur fimmtudaginn 26. janÃºar
                        Ã¡ miÃ°nÃ¦tti.
                    </p>
                    <Encourage>
                        Til aÃ° auka enn Ã¡ spennuna mun stigataflan verÃ°a hulin
                        frÃ¡ kl: 14:00 miÃ°vikudaginn 26. janÃºar Ã¾ar til Ãºrslit
                        verÃ°a kynnt Ã¡ Facebook sÃ­Ã°um SamrÃ³ms og AlmannarÃ³ms Ã¾ann
                        27. janÃºar kl 11:00.
                    </Encourage>
                </>
            )}
            <p>
                Smelltu Ã¡{' '}
                <Link href={'/takathatt'} passHref>
                    <StyledLink>Taka Ã¾Ã¡tt</StyledLink>
                </Link>{' '}
                til hjÃ¡lpa Ã¾Ã­num skÃ³la aÃ° sigra!
            </p>
        </>
    );
};

const AboutSuspense: React.FunctionComponent = () => {
    return (
        <>
            {isCompetitionOver() ? (
                <Title>HvaÃ°a skÃ³li las mest?</Title>
            ) : (
                <Title>HvaÃ°a skÃ³li les mest?</Title>
            )}
            <p>ÃriÃ°ja Lestrarkeppni grunnskÃ³lanna 20 til 26. janÃºar.</p>
            <p>
                Nemendur, foreldrar og starfsfÃ³lk skÃ³la geta lesiÃ° inn fyrir
                sinn skÃ³la. ViÃ° hvetjum alla til aÃ° taka Ã¾Ã¡tt Ã¾vÃ­ miklu skiptir
                aÃ° fÃ¡ framlÃ¶g frÃ¡ breiÃ°um hÃ³pi og tryggja Ã¾annig aÃ° tÃ¦knin
                skilji raddir og framburÃ° allra.
            </p>
            <p>
                SkÃ³lum er skipt Ã­ Ã¾rjÃ¡ flokka lÃ­kt og Ã­ fyrra og verÃ°laun veitt
                fyrir efsta sÃ¦tiÃ° Ã­ hverjum flokki.
            </p>
            <Paragraph>
                Sigurvegari hvers flokks fÃ¦r vegleg verÃ°laun frÃ¡ Elko en hver
                sigurskÃ³li mun fÃ¡{' '}
                <span>Monoprice MP10 Mini Ã¾rÃ­vÃ­ddar prentara</span> og eitt sett
                af <span>Rasberry Pi 400 tÃ¶lvu</span>. Einnig verÃ°a veitt
                verÃ°laun til Ã¾riggja skÃ³la sem skara fram Ãºr, en vinna ekki sinn
                flokk, en hver Ã¾eirra mun fÃ¡ tvÃ¶ sett af{' '}
                <span>Rasberry Pi 400 tÃ¶lvum</span>.
            </Paragraph>

            {isCompetitionOver() ? (
                <Announcement>
                    Keppninni er lokiÃ°. Ãrslit verÃ°a kynnt Ã¡ Facebook sÃ­Ã°um{' '}
                    <Link href={'https://www.facebook.com/samromur'} passHref>
                        <StyledLink>SamrÃ³ms</StyledLink>
                    </Link>{' '}
                    og{' '}
                    <Link
                        href={'https://www.facebook.com/almannaromur'}
                        passHref
                    >
                        <StyledLink>AlmannarÃ³ms</StyledLink>
                    </Link>{' '}
                    Ã¾ann 27. janÃºar kl 11:00.
                </Announcement>
            ) : (
                <>
                    <Paragraph>
                        <span>
                            Til aÃ° auka enn Ã¡ spennuna mun stigataflan verÃ°a
                            hulin frÃ¡ kl: 14:00 miÃ°vikudaginn 26. janÃºar Ã¾ar til
                            Ãºrslit verÃ°a kynnt Ã¡ Facebook sÃ­Ã°um{' '}
                            <Link
                                href={'https://www.facebook.com/samromur'}
                                passHref
                            >
                                <StyledLink>SamrÃ³ms</StyledLink>
                            </Link>{' '}
                            og{' '}
                            <Link
                                href={'https://www.facebook.com/almannaromur'}
                                passHref
                            >
                                <StyledLink>AlmannarÃ³ms</StyledLink>
                            </Link>{' '}
                            Ã¾ann 27. janÃºar kl 11:00.
                        </span>
                    </Paragraph>
                    <Announcement>
                        Keppninni er ekki lokiÃ°, endilega haltu Ã¡fram aÃ° lesa!
                    </Announcement>
                </>
            )}
        </>
    );
};

const AboutAfter: React.FunctionComponent = () => {
    return (
        <>
            <Title>HvaÃ°a skÃ³li las mest?</Title>
            <Paragraph>
                Lestrarkeppni grunnskÃ³la stÃ³Ã° yfir 20. - 26. janÃºar 2022.
                Keppnin var hreint Ãºt sagt Ã³trÃºleg og allir sem tÃ³ku Ã¾Ã¡tt eiga
                hrÃ³s skiliÃ°.
            </Paragraph>
            <Paragraph>
                SmÃ¡ tÃ¶lulegar upplÃ½singar, Ã­ heildina lÃ¡su 5.652 Ã¾Ã¡tttakendur um
                1,3 milljÃ³nir setningar fyrir hÃ¶nd 118 skÃ³la. VerkefniÃ° hefur
                staÃ°iÃ° yfir frÃ¡ Ã¾vÃ­ lok Ã¡rs 2019 og fram aÃ° keppninni hÃ¶fÃ°um viÃ°
                safnaÃ° um 1,5 milljÃ³nir setningum. ÃaÃ° gerir um 230 setningu Ã¡
                hvern Ã¾Ã¡tttakanda en raunin var aÃ° 87 keppendur lÃ¡su yfir Ã¾Ãºsund
                setninga hver.
            </Paragraph>
            <Paragraph>
                Veitt voru verÃ°laun til skÃ³lanna sem voru Ã­ fyrsta sÃ¦ti Ã­ sÃ­num
                flokki, auk Ã¾ess fengu Ã¾rÃ­r skÃ³lar sem lÃ¡su mest Ã¾vert Ã¡ flokka
                Ã¾ar Ã¡ eftir viÃ°urkenningu fyrir framÃºrskarandi Ã¡rangur.
                SkÃ³larnir sem sigruÃ°u sÃ­na flokka voru SalaskÃ³li, SmÃ¡raskÃ³li og
                HÃ¶fÃ°askÃ³li. SkÃ³larnir sem fengur viÃ°urkenningu fyrir
                framÃºrskarandi Ã¡rangur voru SandgerÃ°isskÃ³li, ÃxarfjarÃ°arskÃ³li og
                GerÃ°askÃ³li.
            </Paragraph>
        </>
    );
};

const AboutCompetitions: React.FunctionComponent = () => {
    return (
        <>
            <Title>Um Keppnina</Title>
            <p>
                MarkmiÃ° Ã¾essarar keppni er aÃ° hvetja ungt fÃ³lk til Ã¾Ã¡tttÃ¶ku Ã­
                verkefninu SamrÃ³mur sem snÃ½r aÃ° Ã¾vÃ­ aÃ° safna upptÃ¶kum af lestri
                sem notaÃ°ar verÃ°a til aÃ° kenna tÃ¶lvum og tÃ¦kjum aÃ° skilja
                Ã­slensku.{' '}
                <Link href={'/um'} passHref>
                    <StyledLink>Lesa meira hÃ©r</StyledLink>
                </Link>
                .
            </p>
            <Paragraph>
                Ã fyrstu keppni 2020 Ã¾Ã¡ tÃ³ku <span>1.430</span> manns Ã¾Ã¡tt fyrir
                hÃ¶nd <span>130</span> skÃ³la og lÃ¡su Ã­ kringum <span>144</span>{' '}
                Ã¾Ãºsund setningar. Alls tÃ³ku um <span>6.000</span> manns Ã¾Ã¡tt
                fyrir hÃ¶nd <span>136</span> skÃ³la og lÃ¡su rÃºmlega{' '}
                <span>776</span> Ã¾Ãºsund setningar Ã­ annarri Lestrarkeppni
                grunnskÃ³la 2021. Yfir <span>920</span> Ã¾Ãºsund innlesnar
                setningar hafa Ã¾vÃ­ safnast undanfarin tvÃ¶ Ã¡r og erum viÃ° Ã¾vÃ­
                afar spennt fyrir Ã¾essari Ã¾riÃ°ju keppni og vonumst eftir
                Ã¾Ã¡tttÃ¶ku sem flestra skÃ³la.
            </Paragraph>
        </>
    );
};

export default Competition;
